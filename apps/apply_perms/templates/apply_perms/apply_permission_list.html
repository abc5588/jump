{% extends '_base_list.html' %}
{% load i18n %}
{% load apply_perms_tags %}
{% block content_left_head %}
    <a href="{% url 'apply-perms:apply-permission-create' %}" class="btn btn-sm btn-primary">
        {% trans "Create apply permission" %}
    </a>
{% endblock %}

{% block table_head %}
    <th class="text-center">{% trans 'ID' %}</th>
    <th class="text-center">{% trans 'Name' %}</th>
    <th class="text-center">{% trans 'Applicant' %}</th>
    <th class="text-center">{% trans 'User groups' %}</th>
    <th class="text-center">{% trans 'Asset' %}</th>
    <th class="text-center">{% trans 'Asset group' %}</th>
    <th class="text-center">{% trans 'System user' %}</th>
    <th class="text-center">{% trans 'Approver' %}</th>
    <th class="text-center">{% trans 'Status' %}</th>
    <th class="text-center">{% trans 'Date applied' %}</th>
    <th class="text-center">{% trans 'Date approved' %}</th>
    <th class="text-center">{% trans 'Action' %}</th>
{% endblock %}

{% block table_body %}
     {% for apply_permission in apply_permission_list %}
         <tr class="gradeX">
             <td class="text-center">{{ apply_permission.id }}</td>
             <td class="text-center">{{ apply_permission.name }}</td>
             <td class="text-center">{{ apply_permission.applicant }}</td>
             <td class="text-center">{{ apply_permission | id_to_name:"user_groups" }}</td>
             <td class="text-center">{{ apply_permission | id_to_name:"assets" }}</td>
             <td class="text-center">{{ apply_permission | id_to_name:"asset_groups" }}</td>
             <td class="text-center">{{ apply_permission | id_to_name:"system_users" }}</td>
             <td class="text-center">{{ apply_permission.approver }}</td>
             <td class="text-center">{% trans apply_permission.status %}</td>
             <td class="text-center">{{ apply_permission.date_applied }}</td>
             <td class="text-center">{{ apply_permission.date_approved }}</td>
             <td class="text-center">
                {% if apply_permission.is_updateable %}
                 <a href="{% url 'apply-perms:apply-permission-update' pk=apply_permission.id %}"
                    class="btn btn-xs btn-info">{% trans 'Update' %}
                 </a>
                {% endif %}
                {% if request.user.is_superuser or apply_permission.approver == request.user %}
                 <a class="btn btn-xs btn-info btn-approve" data-name="{{ apply_permission.name }}"
                    data-uid="{{ apply_permission.id }}">{% trans 'Approved' %}
                 </a>
                 <a class="btn btn-xs btn-danger btn-disapprove" data-name="{{ apply_permission.name }}"
                    data-uid="{{ apply_permission.id }}">{% trans 'Disapproved' %}
                 </a>
                {% endif %}
                {% if apply_permission.applicant == request.user %}
                 <a class="btn btn-xs btn-danger btn-del" data-name="{{ apply_permission.name }}"
                    data-uid="{{ apply_permission.id }}">{% trans 'Cancel Apply' %}
                 </a>
                {% endif %}
             </td>
         </tr>
     {% endfor %}
{% endblock %}

{% block custom_foot_js %}
    <script>
        $(document).ready(function() {
            $('table').DataTable({
                "searching": false,
                "paging": false,
                "order": []
            })
        }).on('click', '.btn-del', function () {
            var $this = $(this);
            var name = $this.data('name');
            var uid = $this.data('uid');
            var the_url = '{% url "api-apply-perms:apply-permission-detail" pk=99991937 %}'
                    .replace('99991937', uid);
            objectDelete($this, name, the_url);
        })
    </script>
{% endblock %}
